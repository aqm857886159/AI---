# AIå˜šå§å˜š é¡¹ç›®æ–‡æ¡£

> **ç‰ˆæœ¬**: 2.0  
> **æœ€åæ›´æ–°**: 2025-12-28  
> **æ–‡æ¡£ç›®çš„**: å¸®åŠ© AI åœ¨æ¯æ¬¡æ”¹åŠ¨æ—¶å¿«é€Ÿç†è§£é¡¹ç›®æ¶æ„å’Œéµå®ˆå¼€å‘è§„èŒƒ

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
3. [ç›®å½•ç»“æ„](#3-ç›®å½•ç»“æ„)
4. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#4-æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
5. [æ¶æ„ä¸æ•°æ®æµ](#5-æ¶æ„ä¸æ•°æ®æµ)
6. [AI è§’è‰²ä¸ Prompt è®¾è®¡](#6-ai-è§’è‰²ä¸-prompt-è®¾è®¡)
7. [çŠ¶æ€ç®¡ç†](#7-çŠ¶æ€ç®¡ç†)
8. [ç±»å‹å®šä¹‰é€ŸæŸ¥](#8-ç±»å‹å®šä¹‰é€ŸæŸ¥)
9. [å¼€å‘è§„èŒƒ](#9-å¼€å‘è§„èŒƒ)
10. [AI æ”¹åŠ¨å‡†åˆ™](#10-ai-æ”¹åŠ¨å‡†åˆ™)
11. [å¸¸è§é—®é¢˜](#11-å¸¸è§é—®é¢˜)
12. [ä¿®æ”¹æ—¥å¿—](#12-ä¿®æ”¹æ—¥å¿—)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 äº§å“å®šä½

**AIå˜šå§å˜š** æ˜¯ä¸€æ¬¾æ™ºèƒ½å†™ä½œåŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·æ¶¦è‰²å’Œä¼˜åŒ–æ–‡ç« ã€‚æ ¸å¿ƒç‰¹ç‚¹ï¼š

- **å¤šè§’è‰² AI ç‚¹è¯„**: 4 ä½æ€§æ ¼å„å¼‚çš„ AI ä¸“å®¶ä»ä¸åŒè§’åº¦è¯„è®ºæ–‡ç« 
- **å…¨æ–‡/é€‰åŒºä¿®è®¢**: æä¾›æ®µè½çº§åˆ«çš„ä¿®æ”¹å»ºè®®ï¼Œçº¢åˆ ç»¿å¢å¯è§†åŒ–
- **å¤¸å¤¸é«˜äº®ç³»ç»Ÿ**: è‡ªåŠ¨è¯†åˆ«æ–‡ç« äº®ç‚¹å¹¶ç»™äºˆé¼“åŠ±
- **æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆ**: æ ¹æ®æ–‡ç« å†…å®¹æ¨èå¸å¼•äººçš„æ ‡é¢˜

### 1.2 æ ¸å¿ƒä»·å€¼

```
ç”¨æˆ·è¾“å…¥æ–‡ç«  â†’ AI å¤šè§’åº¦ç‚¹è¯„ â†’ å¯è§†åŒ–ä¿®è®¢å»ºè®® â†’ ç”¨æˆ·é€æ¡æ¥å—/æ‹’ç» â†’ ä¼˜åŒ–å®Œæˆ
```

### 1.3 é¡¹ç›®è·¯å¾„

| è·¯å¾„ | è¯´æ˜ |
|------|------|
| `d:\AIå˜šå§å˜š\` | å·¥ä½œåŒºæ ¹ç›®å½• |
| `d:\AIå˜šå§å˜š\ai-debade\` | å‰ç«¯é¡¹ç›®ç›®å½• |
| `d:\AIå˜šå§å˜š\ai-debade\src\` | æºä»£ç ç›®å½• |

---

## 2. æŠ€æœ¯æ ˆ

### 2.1 æ ¸å¿ƒä¾èµ–

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 19.2.0 | UI æ¡†æ¶ |
| **TypeScript** | 5.9.3 | ç±»å‹å®‰å…¨ |
| **Vite** | 7.2.4 | æ„å»ºå·¥å…· |
| **Tiptap** | 3.14.0 | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆåŸºäº ProseMirrorï¼‰ |
| **Zustand** | 5.0.9 | çŠ¶æ€ç®¡ç† |
| **Framer Motion** | 12.23.26 | åŠ¨ç”»æ•ˆæœ |

### 2.2 é‡è¦ä¾èµ–è¯´æ˜

| ä¾èµ– | ç”¨é€” |
|------|------|
| `@tiptap/react` | ç¼–è¾‘å™¨ React ç»‘å®š |
| `@tiptap/starter-kit` | ç¼–è¾‘å™¨åŸºç¡€æ‰©å±•åŒ… |
| `diff-match-patch` | æ–‡æœ¬å·®å¼‚æ¯”å¯¹ |
| `prosemirror-changeset` | ä¿®è®¢è¿½è¸ª |
| `canvas-confetti` | å¤¸å¤¸ç²’å­æ•ˆæœ |
| `lucide-react` | å›¾æ ‡åº“ |

### 2.3 AI æœåŠ¡

- **æä¾›å•†**: OpenRouter
- **é»˜è®¤æ¨¡å‹**: `deepseek/deepseek-v3.2`
- **API ç«¯ç‚¹**: `https://openrouter.ai/api/v1`

---

## 3. ç›®å½•ç»“æ„

### 3.1 é¡¶å±‚ç›®å½•

```
d:\AIå˜šå§å˜š\
â”œâ”€â”€ ai-debade/              # ä¸»é¡¹ç›®ç›®å½•
â”œâ”€â”€ AI_CONTEXT_AUDIT.md     # AI ä¸Šä¸‹æ–‡å®¡æŸ¥æ–‡æ¡£ï¼ˆå‚è€ƒï¼‰
â”œâ”€â”€ AI_PRAISE_FEATURE_DESIGN.md # å¤¸å¤¸åŠŸèƒ½è®¾è®¡æ–‡æ¡£ï¼ˆå‚è€ƒï¼‰
â”œâ”€â”€ README.md               # ç”¨æˆ·æ‰‹å†Œ
â””â”€â”€ PROJECT_DOCS.md         # æœ¬æ–‡æ¡£
```

### 3.2 æºä»£ç ç»“æ„

```
ai-debade/src/
â”œâ”€â”€ app/                    # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.tsx            # ä¸»åº”ç”¨ç»„ä»¶ï¼ˆå¸ƒå±€ã€ä¾§è¾¹æ ï¼‰
â”‚   â””â”€â”€ App.css            # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ components/             # UI ç»„ä»¶
â”‚   â”œâ”€â”€ editor/            # ç¼–è¾‘å™¨ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ Editor.tsx     # ä¸»ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Editor.css     # ç¼–è¾‘å™¨æ ·å¼
â”‚   â”‚   â”œâ”€â”€ SelectionToolbar.tsx  # é€‰åŒºå·¥å…·æ 
â”‚   â”‚   â””â”€â”€ SelectionToolbar.css
â”‚   â”‚
â”‚   â”œâ”€â”€ panel/             # é¢æ¿ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CommentPanel.tsx    # AI è¯„è®ºé¢æ¿
â”‚   â”‚   â”œâ”€â”€ CommentPanel.css
â”‚   â”‚   â””â”€â”€ CharacterSelectStyles.css
â”‚   â”‚
â”‚   â”œâ”€â”€ praise/            # å¤¸å¤¸ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CinematicPraise.tsx  # ç”µå½±å¼å¤¸å¤¸å¼¹çª—
â”‚   â”‚   â””â”€â”€ PraiseStyles.css
â”‚   â”‚
â”‚   â”œâ”€â”€ TitleGenerator.tsx # æ ‡é¢˜ç”Ÿæˆç»„ä»¶
â”‚   â”œâ”€â”€ Settings.tsx       # è®¾ç½®å¼¹çª—
â”‚   â”œâ”€â”€ CharacterManager.tsx    # è§’è‰²ç®¡ç†å¼¹çª—
â”‚   â””â”€â”€ CharacterSelector.tsx   # è§’è‰²é€‰æ‹©å™¨
â”‚
â”œâ”€â”€ config/                 # é…ç½®
â”‚   â”œâ”€â”€ constants.ts       # å…¨å±€å¸¸é‡
â”‚   â””â”€â”€ characters.ts      # AI è§’è‰²å®šä¹‰
â”‚
â”œâ”€â”€ features/               # ä¸šåŠ¡åŠŸèƒ½æ¨¡å— â­
â”‚   â”œâ”€â”€ index.ts           # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ ai-review/         # AI è¯„è®ºåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ useAIReview.ts # æ ¸å¿ƒ Hook
â”‚   â”‚   â””â”€â”€ reviewService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ revision/          # ä¿®è®¢è¿½è¸ªåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ useRevision.ts # æ ¸å¿ƒ Hook
â”‚   â”‚   â”œâ”€â”€ revisionService.ts
â”‚   â”‚   â””â”€â”€ trackChangesPlugin.ts  # ProseMirror æ’ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ praise/            # å¤¸å¤¸åŠŸèƒ½
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ usePraise.ts   # æ ¸å¿ƒ Hook
â”‚       â”œâ”€â”€ praiseService.ts
â”‚       â””â”€â”€ praisePlugin.ts # ProseMirror æ’ä»¶
â”‚
â”œâ”€â”€ services/               # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ openrouter.ts      # OpenRouter API å°è£…
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ diffUtils.ts   # å·®å¼‚è®¡ç®—å·¥å…·
â”‚
â”œâ”€â”€ store/                  # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useStore.ts        # ä¸» Store
â”‚   â””â”€â”€ slices/
â”‚       â”œâ”€â”€ createAISlice.ts      # AI è§’è‰²/è¯„è®ºçŠ¶æ€
â”‚       â”œâ”€â”€ createContentSlice.ts # æ–‡ç« å†…å®¹çŠ¶æ€
â”‚       â”œâ”€â”€ createRevisionSlice.ts # ä¿®è®¢çŠ¶æ€
â”‚       â””â”€â”€ createPraiseSlice.ts  # å¤¸å¤¸çŠ¶æ€
â”‚
â”œâ”€â”€ types/                  # é€šç”¨ç±»å‹
â”‚   â””â”€â”€ global.ts
â”‚
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ helpers.ts
â”‚
â”œâ”€â”€ index.css              # å…¨å±€åŸºç¡€æ ·å¼
â””â”€â”€ main.tsx               # å…¥å£æ–‡ä»¶
```

### 3.3 å…³é”®çº¦å®š

| çº¦å®š | è¯´æ˜ |
|------|------|
| `features/` | ä¸šåŠ¡é€»è¾‘å±‚ï¼Œæ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æ–‡ä»¶å¤¹ |
| `components/` | çº¯ UI ç»„ä»¶ï¼Œä¸å«ä¸šåŠ¡é€»è¾‘ |
| `services/` | å¤–éƒ¨æœåŠ¡è°ƒç”¨ï¼ˆAPIã€å·¥å…·å‡½æ•°ï¼‰ |
| `store/slices/` | Zustand çŠ¶æ€åˆ‡ç‰‡ï¼ŒæŒ‰åŠŸèƒ½åˆ’åˆ† |
| `use*.ts` | è‡ªå®šä¹‰ Hook æ–‡ä»¶å‘½åè§„èŒƒ |
| `*Service.ts` | æœåŠ¡å±‚æ–‡ä»¶å‘½åè§„èŒƒ |

---

## 4. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 4.1 AI è¯„è®ºç³»ç»Ÿ (`features/ai-review/`)

#### åŠŸèƒ½æ¦‚è¿°
- ç”¨æˆ·ç‚¹å‡»"AIå˜šå§å˜š"æŒ‰é’®ï¼Œ4 ä½ AI è§’è‰²ä¾æ¬¡ç”Ÿæˆè¯„è®º
- æ”¯æŒå…¨æ–‡è¯„è®ºå’Œé€‰åŒºè¯„è®ºä¸¤ç§æ¨¡å¼
- æ¯ä½è§’è‰²åŒæ—¶è¿”å›è¯„è®ºæ–‡æœ¬å’Œä¿®è®¢å»ºè®®

#### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `useAIReview.ts` | è¯„è®ºç”Ÿæˆæµç¨‹æ§åˆ¶ Hook |
| `reviewService.ts` | è§’è‰²è¯„è®º API è°ƒç”¨å°è£… |
| `types.ts` | `AICharacter`, `Comment`, `CharacterRevisionOutput` ç±»å‹ |

#### æ•°æ®æµ

```
ç”¨æˆ·ç‚¹å‡» â†’ useAIReview.startReview()
  â†’ éå†é€‰ä¸­è§’è‰²
  â†’ reviewService.generateCharacterReview()
  â†’ openRouterService.getCommentWithRevisions()
  â†’ è§£æ JSON å“åº”
  â†’ store.addComment() + åˆå¹¶ä¿®è®¢
  â†’ è§¦å‘ UI æ›´æ–°
```

#### å…³é”®å‡½æ•°

```typescript
// useAIReview.ts
startReview(selectedCharacterIds: string[]): Promise<void>
startSelectionReview(selectedText: string, paragraphs: [...]): Promise<void>
generateRewriteFromComment(commentContent: string): Promise<void>
```

---

### 4.2 ä¿®è®¢è¿½è¸ªç³»ç»Ÿ (`features/revision/`)

#### åŠŸèƒ½æ¦‚è¿°
- æ˜¾ç¤º"çº¢åˆ ç»¿å¢"å¼çš„ä¿®æ”¹å¯¹æ¯”
- æ¯å¤„ä¿®æ”¹å¯ç‹¬ç«‹æ¥å—æˆ–æ‹’ç»
- æ”¯æŒå…¨éƒ¨æ¥å—/å…¨éƒ¨æ‹’ç»

#### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `useRevision.ts` | ä¿®è®¢æ“ä½œé€»è¾‘ Hook |
| `revisionService.ts` | ä¿®è®¢æ•°æ®å¤„ç†ï¼ˆåˆå¹¶ã€è°ƒæ•´ç´¢å¼•ï¼‰ |
| `trackChangesPlugin.ts` | ProseMirror æ¸²æŸ“æ’ä»¶ |
| `types.ts` | `ParagraphChange`, `FullTextRewrite` ç±»å‹ |

#### æ•°æ®æµ

```
AI è¿”å›ä¿®è®¢ â†’ createParagraphChangesFromRevisions()
  â†’ è®¡ç®— inlineDiff
  â†’ store.setFullTextRewrite()
  â†’ trackChangesPlugin æ¸²æŸ“è£…é¥°

ç”¨æˆ·ç‚¹å‡»æ¥å— â†’ useRevision.acceptChange()
  â†’ applyChangeToDocument()
  â†’ adjustIndicesAfterAccept()
  â†’ æ›´æ–° store
```

#### å…³é”®å‡½æ•°

```typescript
// useRevision.ts
acceptChange(changeId: string, editor: any): void
rejectChange(changeId: string): void
acceptAllChanges(editor: any): void
rejectAllChanges(): void
```

---

### 4.3 å¤¸å¤¸é«˜äº®ç³»ç»Ÿ (`features/praise/`)

#### åŠŸèƒ½æ¦‚è¿°
- è‡ªåŠ¨æ£€æµ‹å†™ä½œè¿›æ­¥ï¼Œç»™äºˆé¼“åŠ±
- è¯†åˆ«é‡‘å¥ã€æƒ…æ„Ÿè¡¨è¾¾ã€é€»è¾‘æ¸…æ™°ç­‰äº®ç‚¹
- æ¯å¢å†™ 300 å­—è§¦å‘ä¸€æ¬¡å¤¸å¤¸æ£€æµ‹

#### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `usePraise.ts` | å¤¸å¤¸è§¦å‘å’ŒçŠ¶æ€ç®¡ç† Hook |
| `praiseService.ts` | å¤¸å¤¸ API è°ƒç”¨å°è£… |
| `praisePlugin.ts` | ProseMirror é«˜äº®æ¸²æŸ“æ’ä»¶ |
| `types.ts` | `PraiseRecord`, `PraiseHighlight` ç±»å‹ |

#### è§¦å‘æœºåˆ¶

```
ç¼–è¾‘å™¨å†…å®¹å˜åŒ– â†’ useAutoPraise æ£€æµ‹å­—æ•°å¢é‡
  â†’ å¢é‡ >= 300 å­— â†’ praiseService.generateIncrementalPraise()
  â†’ å¢é‡ >= 500 å­— â†’ praiseService.generateBulkPraise()
  â†’ ç»“æœå­˜å…¥ store.praiseHistory
  â†’ è§¦å‘å½©è›‹åŠ¨ç”»
```

#### å¤¸å¤¸ç±»å‹

| ç±»å‹ | è¯´æ˜ |
|------|------|
| `golden_sentence` | é‡‘å¥ |
| `fluency` | æµç•…è¡¨è¾¾ |
| `logic` | é€»è¾‘æ¸…æ™° |
| `emotion` | æƒ…æ„Ÿå…±é¸£ |
| `progress` | å†™ä½œè¿›æ­¥ |

---

### 4.4 æ ‡é¢˜ç”Ÿæˆ (`components/TitleGenerator.tsx`)

#### åŠŸèƒ½æ¦‚è¿°
- æ ¹æ®æ–‡ç« å†…å®¹ç”Ÿæˆå¸å¼•äººçš„æ ‡é¢˜
- æ˜¾ç¤ºæ¨èç†ç”±

#### æ•°æ®æµ

```
ç‚¹å‡»"æ ‡é¢˜ç”Ÿæˆ" â†’ openRouterService.generateTitle()
  â†’ è¿”å› { title, reason }
  â†’ æ›´æ–° UI
```

---

## 5. æ¶æ„ä¸æ•°æ®æµ

### 5.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           App.tsx (å¸ƒå±€å±‚)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           â”‚                              â”‚                          â”‚
â”‚   TitleGenerator          Editor                    CommentPanel    â”‚
â”‚           â”‚                              â”‚                          â”‚
â”‚           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚           â”‚         â”‚                   â”‚                  â”‚        â”‚
â”‚           â”‚   SelectionToolbar   trackChangesPlugin  praisePlugin   â”‚
â”‚           â”‚         â”‚                   â”‚                  â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚         â”‚                   â”‚                  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚â”‚                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                    â”‚
         â”‚            â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚useAIReviewâ”‚ â”‚useRevisionâ”‚       â”‚ usePraise â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   useStore    â”‚ (Zustand)
              â”‚   (4 Slices)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ openRouterService â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              OpenRouter API
```

### 5.2 æ¨¡å—ä¾èµ–å…³ç³»

```
components/
    â””â”€â”€ ä¾èµ– â†’ features/ (é€šè¿‡ Hooks)
                   â””â”€â”€ ä¾èµ– â†’ services/ (API è°ƒç”¨)
                                  â””â”€â”€ ä¾èµ– â†’ config/ (å¸¸é‡)

store/
    â””â”€â”€ è¢« features/ å’Œ components/ æ¶ˆè´¹
```

### 5.3 ç¦æ­¢çš„ä¾èµ–æ–¹å‘

- âŒ `services/` ä¸å¾—ä¾èµ– `components/`
- âŒ `config/` ä¸å¾—ä¾èµ–ä»»ä½•å…¶ä»–æ¨¡å—
- âŒ `store/` ä¸å¾—ç›´æ¥è°ƒç”¨ `services/`ï¼ˆåº”é€šè¿‡ Hooksï¼‰

---

## 6. AI è§’è‰²ä¸ Prompt è®¾è®¡

### 6.1 é»˜è®¤è§’è‰²åˆ—è¡¨

| ID | åç§° | èŒè´£ | å…³é”®è¯ |
|----|------|------|--------|
| `doctor` | è€å¼  (çº é”™) | è¯­æ³•ã€é”™åˆ«å­—ã€æ ‡ç‚¹ | ä¸¥è°¨ã€æ¯’èˆŒ |
| `polisher` | å©‰å„¿ (æ¶¦è‰²) | æ–‡é‡‡ã€æ„ŸæŸ“åŠ› | ä¼˜é›…ã€ç»†è…» |
| `logic` | é˜¿åŸº (é€»è¾‘) | è®ºç‚¹ã€è®ºæ®ã€ç»“æ„ | ç†æ€§ã€ç¡¬æ ¸ |
| `creative` | çš®çš® (è„‘æ´) | åˆ›æ„ã€æ–°é¢–è§’åº¦ | è·³è„±ã€å¹½é»˜ |
| `praise` | å¤¸å¤¸ (é«˜å…‰) | è¯†åˆ«äº®ç‚¹ï¼ˆéšè—è§’è‰²ï¼‰ | æ¸©æš–ã€ç²‰ä¸è§†è§’ |

### 6.2 Prompt è¾“å‡ºæ ¼å¼

æ¯ä¸ªè§’è‰²çš„ Prompt è¦æ±‚ AI è¿”å› JSON æ ¼å¼ï¼š

```json
{
  "comment": "æ€»ä½“è¯„ä»·ï¼ˆ40-60å­—ï¼‰",
  "revisions": [
    {
      "type": "replace",
      "original": "åŸæ–‡ç‰‡æ®µï¼ˆç²¾ç¡®åŒ¹é…ï¼‰",
      "improved": "æ”¹è¿›åæ–‡æœ¬",
      "reason": "ä¿®æ”¹ç†ç”±ï¼ˆ5-10å­—ï¼‰"
    }
  ]
}
```

### 6.3 Prompt è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **ç²¾ç¡®åŒ¹é…** | `original` å¿…é¡»æ˜¯åŸæ–‡çš„ç²¾ç¡®å­ä¸² |
| **ç®€æ´ç†ç”±** | `reason` æ§åˆ¶åœ¨ 5-15 å­— |
| **åˆ†å·¥æ˜ç¡®** | æ¯ä¸ªè§’è‰²åªåšè‡ªå·±çš„äº‹ï¼Œä¸è¶Šç•Œ |
| **è¯´äººè¯** | é¿å…å­¦æœ¯æœ¯è¯­ï¼Œç”¨æ—¥å¸¸è¡¨è¾¾ |

### 6.4 ä¿®æ”¹ Prompt é¡»çŸ¥

> âš ï¸ **è­¦å‘Š**: Prompt å·²ç»è¿‡å¤šæ¬¡è°ƒä¼˜ï¼Œä¿®æ”¹å‰è¯·ä¸ç”¨æˆ·ç¡®è®¤ï¼

ä¿®æ”¹æ—¶éœ€æ³¨æ„ï¼š
1. ä¿æŒ JSON è¾“å‡ºæ ¼å¼ä¸å˜
2. ä¸è¦æ”¹å˜è¯„åˆ†æ ‡å‡†ï¼ˆå¦‚æœ‰ï¼‰
3. æµ‹è¯•è‡³å°‘ 3 ç¯‡ä¸åŒé£æ ¼çš„æ–‡ç« 

---

## 7. çŠ¶æ€ç®¡ç†

### 7.1 Store ç»“æ„

ä½¿ç”¨ Zustand çš„ Slice æ¨¡å¼ï¼Œå°†çŠ¶æ€æŒ‰åŠŸèƒ½æ‹†åˆ†ï¼š

```typescript
// store/useStore.ts
export type AppState = ContentSlice & AISlice & RevisionSlice & PraiseSlice;
```

### 7.2 å„ Slice èŒè´£

#### ContentSlice - æ–‡ç« å†…å®¹

```typescript
interface ContentSlice {
    content: string;           // å½“å‰æ–‡ç« å†…å®¹ (HTML)
    setContent: (c: string) => void;
}
```

#### AISlice - AI è§’è‰²ä¸è¯„è®º

```typescript
interface AISlice {
    characters: AICharacter[];     // è§’è‰²åˆ—è¡¨
    comments: Comment[];           // è¯„è®ºåˆ—è¡¨
    isGeneratingComments: boolean; // ç”Ÿæˆä¸­æ ‡å¿—
    aiSuggestions: AISuggestion[]; // AI å»ºè®®åˆ—è¡¨
    
    // UI çŠ¶æ€
    showSettings: boolean;
    showCharacterManager: boolean;
    
    // Actions
    addCharacter / removeCharacter / updateCharacter
    addComment / clearComments
    addAISuggestion / removeAISuggestion
    setShowSettings / setShowCharacterManager
}
```

#### RevisionSlice - ä¿®è®¢çŠ¶æ€

```typescript
interface RevisionSlice {
    fullTextRewrite: FullTextRewrite | null;  // å½“å‰ä¿®è®¢ä¼šè¯
    isRewriting: boolean;                      // æ”¹å†™ä¸­æ ‡å¿—
    workflowStage: WorkflowStage;             // å·¥ä½œæµé˜¶æ®µ
    
    setFullTextRewrite / setIsRewriting / setWorkflowStage
}
```

#### PraiseSlice - å¤¸å¤¸çŠ¶æ€

```typescript
interface PraiseSlice {
    praiseHistory: PraiseRecord[];  // å¤¸å¤¸å†å²
    readPraises: Set<string>;       // å·²è¯»å¤¸å¤¸ ID
    wordCountState: WordCountState; // å­—æ•°è¿½è¸ª
    
    addPraiseRecord / markPraiseAsRead / clearPraiseHistory
    setWordCount
}
```

### 7.3 çŠ¶æ€ä½¿ç”¨ç¤ºä¾‹

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const comments = useStore(state => state.comments);
const addComment = useStore(state => state.addComment);

// åœ¨ Hook ä¸­ä½¿ç”¨
const fullTextRewrite = useStore(state => state.fullTextRewrite);
const setFullTextRewrite = useStore(state => state.setFullTextRewrite);
```

---

## 8. ç±»å‹å®šä¹‰é€ŸæŸ¥

### 8.1 AI è¯„è®ºç›¸å…³

```typescript
// features/ai-review/types.ts

interface AICharacter {
    id: string;
    name: string;
    avatar: string | React.ElementType;
    avatarUrl?: string;
    personality: string;
    style: string[];
    systemPrompt: string;
    isCustom: boolean;
    hiddenFromPanel?: boolean;
}

interface Comment {
    id: string;
    characterId: string;
    type: 'full' | 'selection';
    content: string;
    position?: { from: number; to: number };
    suggestion?: string;
    timestamp: number;
}

interface CharacterRevisionOutput {
    comment: string;
    revisions: RevisionItem[];
}
```

### 8.2 ä¿®è®¢ç›¸å…³

```typescript
// features/revision/types.ts

type ParagraphChangeType = 'modified' | 'added' | 'deleted' | 'praise';

interface ParagraphChange {
    id: string;
    index: number;
    type: ParagraphChangeType;
    originalText: string;
    improvedText?: string;
    inlineDiff?: InlineDiffPart[];
    reason?: string;
    nodePos: number;
    sourceCharacterId?: string;
    sourceCharacterName?: string;
}

interface RevisionItem {
    type: 'replace' | 'insert_after' | 'delete' | 'suggest';
    original: string;
    improved: string;
    reason: string;
}

interface FullTextRewrite {
    id: string;
    originalText: string;
    improvedText: string;
    paragraphChanges: ParagraphChange[];
    timestamp: number;
}
```

### 8.3 å¤¸å¤¸ç›¸å…³

```typescript
// features/praise/types.ts

type PraiseType = 'golden_sentence' | 'fluency' | 'logic' | 'emotion' | 'progress' | 'rhetoric' | 'insight';

interface PraiseRecord {
    id: string;
    timestamp: number;
    type: PraiseType;
    quote?: string;
    wow: string;
    reason: string;
    wordCountWhen: number;
}

interface PraiseHighlight {
    id: string;
    type: PraiseType;
    quote: string;
    reason: string;
    wow?: string;
}
```

---

## 9. å¼€å‘è§„èŒƒ

### 9.1 ä»£ç é£æ ¼

| è§„èŒƒ | è¯´æ˜ |
|------|------|
| **ç¼©è¿›** | 4 ç©ºæ ¼ |
| **å¼•å·** | å•å¼•å· |
| **åˆ†å·** | å¿…é¡» |
| **è¡Œå°¾é€—å·** | ES5 é£æ ¼ |
| **æ–‡ä»¶å‘½å** | ç»„ä»¶ PascalCaseï¼Œå·¥å…· camelCase |

### 9.2 ç»„ä»¶è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹
2. **UI/é€»è¾‘åˆ†ç¦»**: ç»„ä»¶åªè´Ÿè´£æ¸²æŸ“ï¼Œé€»è¾‘æ”¾ Hooks
3. **Props ç±»å‹**: å¿…é¡»å®šä¹‰ TypeScript æ¥å£
4. **æ³¨é‡Š**: æ¯ä¸ªæ–‡ä»¶é¡¶éƒ¨å¿…é¡»æœ‰ `@module` å’Œ `@description`

### 9.3 æ–‡ä»¶å¤´æ³¨é‡Šæ¨¡æ¿

```typescript
/**
 * @module [æ¨¡å—è·¯å¾„]
 * @description [åŠŸèƒ½æè¿°] - å•ä¸€èŒè´£ï¼š[èŒè´£è¯´æ˜]
 * 
 * èŒè´£ï¼š
 * - [èŒè´£1]
 * - [èŒè´£2]
 */
```

### 9.4 è°ƒè¯•æ—¥å¿—è§„èŒƒ

é¡¹ç›®ä½¿ç”¨ emoji å‰ç¼€çš„è°ƒè¯•æ—¥å¿—ï¼Œä¾¿äºè¿½è¸ªï¼š

```typescript
console.log('ğŸ­ [App] ç»„ä»¶æ¸²æŸ“');
console.log('âœ… [useRevision] æ¥å—ä¿®æ”¹:', changeId);
console.log('âŒ [useRevision] æ‹’ç»ä¿®æ”¹:', changeId);
console.log('âœ¨ [AutoPraise] ç”Ÿæˆå¤¸å¤¸');
console.log('ğŸ“Š [AutoPraise] å­—æ•°ç»Ÿè®¡');
console.log('ğŸ—„ï¸ [useStore] Store æ„å»º');
```

> âš ï¸ **ä¸è¦åˆ é™¤è¿™äº›æ—¥å¿—**ï¼Œå®ƒä»¬ç”¨äºå¼€å‘è°ƒè¯•ã€‚

---

## 10. AI æ”¹åŠ¨å‡†åˆ™

### 10.1 æ”¹åŠ¨å‰å¿…è¯»æ¸…å•

åœ¨è¿›è¡Œä»»ä½•ä»£ç ä¿®æ”¹ä¹‹å‰ï¼ŒAI å¿…é¡»ï¼š

- [ ] é˜…è¯»æœ¬æ–‡æ¡£çš„ç›¸å…³æ¨¡å—ç« èŠ‚
- [ ] ç¡®è®¤æ”¹åŠ¨ä¸ä¼šç ´åæ¨¡å—ä¾èµ–å…³ç³»ï¼ˆå‚è§ 5.3ï¼‰
- [ ] æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥æ›´æ–°ç±»å‹å®šä¹‰
- [ ] äº†è§£è¯¥æ¨¡å—çš„è®¾è®¡çº¦æŸ

### 10.2 ç¦æ­¢äº‹é¡¹

| ç¦æ­¢è¡Œä¸º | åŸå›  |
|---------|------|
| åˆ é™¤å¸¦ emoji å‰ç¼€çš„ console.log | è¿™äº›æ˜¯æœ‰æ„ä¿ç•™çš„è°ƒè¯•æ—¥å¿— |
| ä¿®æ”¹ `config/constants.ts` å¸¸é‡å€¼è€Œä¸é€šçŸ¥ç”¨æˆ· | å¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒå’Œ API æˆæœ¬ |
| åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ `openRouterService` | åº”é€šè¿‡ `features/` å±‚çš„ Hooks å°è£… |
| åˆå¹¶æˆ–æ‹†åˆ†ç°æœ‰çš„ Zustand slices | ä¼šç ´åçŠ¶æ€ç®¡ç†æ¶æ„ |
| ä¿®æ”¹ AI è§’è‰²çš„ systemPrompt è€Œä¸é€šçŸ¥ç”¨æˆ· | Prompt å·²ç»è¿‡è°ƒä¼˜ |
| åˆ é™¤æˆ–é‡å‘½å `features/index.ts` çš„å¯¼å‡º | ä¼šç ´åå…¶ä»–æ¨¡å—çš„å¯¼å…¥ |

### 10.3 æ”¹åŠ¨åæ£€æŸ¥é¡¹

æ¯æ¬¡å®Œæˆæ”¹åŠ¨åï¼ŒAI åº”ï¼š

1. ç¡®ä¿ TypeScript ç¼–è¯‘æ— é”™è¯¯ (`npm run build`)
2. ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ (`npm run dev`)
3. åœ¨æœ¬æ–‡æ¡£"ä¿®æ”¹æ—¥å¿—"ç« èŠ‚æ·»åŠ è®°å½•
4. å¦‚æ¶‰åŠæ¶æ„å˜æ›´ï¼Œæ›´æ–°"æ¶æ„ä¸æ•°æ®æµ"ç« èŠ‚
5. å¦‚æ·»åŠ æ–°åŠŸèƒ½ï¼Œæ›´æ–°"æ ¸å¿ƒåŠŸèƒ½æ¨¡å—"ç« èŠ‚

### 10.4 æ–‡ä»¶ä¿®æ”¹æŒ‡å¼•

| ä¿®æ”¹ç±»å‹ | æ¶‰åŠæ–‡ä»¶ | æ³¨æ„äº‹é¡¹ |
|---------|---------|---------|
| æ·»åŠ æ–° AI è§’è‰² | `config/characters.ts` | éµå¾ªç°æœ‰è§’è‰²æ ¼å¼ |
| ä¿®æ”¹è¯„è®ºç”Ÿæˆé€»è¾‘ | `features/ai-review/` | å…ˆè¯» `useAIReview.ts` |
| ä¿®æ”¹ä¿®è®¢æ¸²æŸ“ | `features/revision/trackChangesPlugin.ts` | ProseMirror çŸ¥è¯†å¿…å¤‡ |
| ä¿®æ”¹å¤¸å¤¸è§¦å‘æ¡ä»¶ | `config/constants.ts` + `features/praise/usePraise.ts` | æ£€æŸ¥é˜ˆå€¼å¸¸é‡ |
| ä¿®æ”¹ UI æ ·å¼ | å¯¹åº” `.css` æ–‡ä»¶ | ä¿æŒç»ç’ƒæ€è®¾è®¡é£æ ¼ |

---

## 11. å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ·»åŠ æ–°çš„ AI è§’è‰²ï¼Ÿ

1. åœ¨ `config/characters.ts` çš„ `DEFAULT_CHARACTERS` æ•°ç»„ä¸­æ·»åŠ æ–°è§’è‰²
2. éµå¾ª `AICharacter` æ¥å£æ ¼å¼
3. ç¼–å†™ `systemPrompt`ï¼Œç¡®ä¿è¾“å‡ºæ ¼å¼ä¸ç°æœ‰è§’è‰²ä¸€è‡´

### Q2: å¦‚ä½•ä¿®æ”¹ä¿®è®¢çš„è§†è§‰æ ·å¼ï¼Ÿ

ä¿®æ”¹ `components/editor/Editor.css` ä¸­çš„ä»¥ä¸‹ç±»ï¼š
- `.diff-deletion` - åˆ é™¤å†…å®¹æ ·å¼
- `.diff-insertion` - æ–°å¢å†…å®¹æ ·å¼
- `.paragraph-actions-floating` - æ“ä½œæŒ‰é’®æ ·å¼

### Q3: å¦‚ä½•è°ƒæ•´å¤¸å¤¸è§¦å‘é¢‘ç‡ï¼Ÿ

ä¿®æ”¹ `config/constants.ts`ï¼š
```typescript
export const PRAISE_TRIGGER_THRESHOLD = 300;  // å­—æ•°é˜ˆå€¼
export const PRAISE_DEBOUNCE_MS = 2000;       // é˜²æŠ–æ—¶é—´
```

### Q4: ä¸ºä»€ä¹ˆè¯„è®ºç”Ÿæˆå¤±è´¥ï¼Ÿ

æ£€æŸ¥ä»¥ä¸‹å¯èƒ½åŸå› ï¼š
1. API Key æœªé…ç½® â†’ æ‰“å¼€è®¾ç½®å¼¹çª—
2. ç½‘ç»œé—®é¢˜ â†’ æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯
3. æ¨¡å‹ä½™é¢ä¸è¶³ â†’ æ£€æŸ¥ OpenRouter è´¦æˆ·

### Q5: å¦‚ä½•ç†è§£ ProseMirror æ’ä»¶ï¼Ÿ

å…³é”®æ–‡ä»¶ï¼š
- `features/revision/trackChangesPlugin.ts` - ä¿®è®¢è£…é¥°
- `features/praise/praisePlugin.ts` - å¤¸å¤¸é«˜äº®

æ ¸å¿ƒæ¦‚å¿µï¼š
- `Plugin` - æ’ä»¶å®šä¹‰
- `PluginKey` - æ’ä»¶çŠ¶æ€è®¿é—®
- `Decoration` - è§†è§‰è£…é¥°

---

## 12. ä¿®æ”¹æ—¥å¿—

### 2025-12-28

- **[æ–‡æ¡£]** åˆ›å»º `PROJECT_DOCS.md` é¡¹ç›®æ–‡æ¡£
  - åŒ…å«å®Œæ•´çš„é¡¹ç›®æ¶æ„è¯´æ˜
  - åŒ…å« AI æ”¹åŠ¨å‡†åˆ™å’Œå¼€å‘è§„èŒƒ
  - åŒ…å«ç±»å‹å®šä¹‰é€ŸæŸ¥è¡¨

---

## é™„å½• A: å¸¸é‡é…ç½®é€ŸæŸ¥

```typescript
// config/constants.ts

// AI é…ç½®
DEFAULT_AI_MODEL = 'deepseek/deepseek-v3.2'
OPENROUTER_BASE_URL = 'https://openrouter.ai/api/v1'
DEFAULT_TEMPERATURE = 0.7
HIGH_CREATIVITY_TEMPERATURE = 0.8

// å¤¸å¤¸é…ç½®
PRAISE_TRIGGER_THRESHOLD = 300   // å­—
PRAISE_DEBOUNCE_MS = 2000        // æ¯«ç§’
BULK_PRAISE_MAX_CHARS = 5000     // å­—
INCREMENTAL_PRAISE_WINDOW = 500  // å­—

// ä¿®è®¢é…ç½®
SIGNIFICANT_CHANGE_RATIO = 0.05  // 5%
HOVER_PREVIEW_DELAY_MS = 300     // æ¯«ç§’

// UI é…ç½®
SIDEBAR_MIN_WIDTH = 250          // åƒç´ 
SIDEBAR_MAX_WIDTH = 800          // åƒç´ 
SIDEBAR_DEFAULT_WIDTH = 340      // åƒç´ 
MIN_CONTENT_LENGTH = 50          // å­—

// è¯„è®ºé™åˆ¶
MAX_COMMENT_LENGTH = 50          // å­—
MAX_REASON_LENGTH = 15           // å­—
```

---

## é™„å½• B: å¿«é€Ÿå¯åŠ¨

```bash
# å®‰è£…ä¾èµ–
cd d:\AIå˜šå§å˜š\ai-debade
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# ç±»å‹æ£€æŸ¥
tsc --noEmit
```

---

**æ–‡æ¡£ç»“æŸ** | å¦‚éœ€æ›´æ–°ï¼Œè¯·ä¿®æ”¹æ­¤æ–‡ä»¶å¹¶åœ¨"ä¿®æ”¹æ—¥å¿—"ç« èŠ‚è®°å½•ã€‚
